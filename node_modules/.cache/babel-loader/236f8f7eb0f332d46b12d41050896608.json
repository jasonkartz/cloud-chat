{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\jason\\\\Documents\\\\1-Web-Projects\\\\cloud-chat\\\\src\\\\components\\\\UserProfile.js\",\n    _s = $RefreshSig$();\n\nimport defaultPic from \"../images/cloud-fill.png\";\nimport { doc, orderBy, limitToLast, collection, setDoc, updateDoc, arrayRemove, arrayUnion, query, where } from \"firebase/firestore\";\nimport { useDocumentData, useCollectionData } from \"react-firebase-hooks/firestore\";\nimport { useState } from \"react\";\nimport { auth, db } from \"../backend/firebase-config\";\nimport Loading from \"./Loading\";\nimport Error from \"./Error\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function Profile(_ref) {\n  _s();\n\n  let {\n    user,\n    accountSelection,\n    setAccountSelection,\n    setScreen,\n    setChatSelection,\n    setOpenMenu\n  } = _ref;\n  const [openFollowList, setOpenFollowList] = useState(false);\n  const [selectFollowList, setSelectFollowList] = useState(\"following\");\n  const selectedAccountRef = doc(db, \"accounts\", accountSelection);\n  const [selectedAccount, selectedAccountLoading, selectedAccountError] = useDocumentData(selectedAccountRef);\n  const userAccountRef = doc(db, \"accounts\", user.uid);\n  const [userAccount, userLoading, userError] = useDocumentData(userAccountRef);\n  const selectedAccountPrivateChatRef = doc(db, \"accounts\", accountSelection, \"privateChats\", user.uid);\n  const [selectedAccountPrivateChat, selectedAccountPrivateChatLoading, selectedAccountPrivateChatError] = useDocumentData(selectedAccountPrivateChatRef);\n  const userPrivateChatRef = doc(db, \"accounts\", user.uid, \"privateChats\", accountSelection);\n  const [userPrivateChat, userPrivateChatLoading, userPrivateChatError] = useDocumentData(userPrivateChatRef);\n\n  const sendMessage = async () => {\n    if (userPrivateChat || selectedAccountPrivateChat) {\n      setChatSelection({\n        id: userPrivateChat.chatID,\n        name: `You and ${selectedAccount.userName || selectedAccount.name}`,\n        path: userPrivateChat.chatPath + \"/messages\"\n      });\n      setOpenMenu(false);\n    } else {\n      const userChatRef = doc(db, \"accounts\", user.uid, \"privateChats\", selectedAccount.uid);\n      const selectedAccountChatRef = doc(db, \"accounts\", selectedAccount.uid, \"privateChats\", user.uid);\n      const newChatRef = doc(collection(db, \"privateChats\"));\n      await setDoc(newChatRef, {\n        id: newChatRef.id,\n        users: [user.uid, selectedAccount.uid]\n      }).then(() => {\n        setDoc(userChatRef, {\n          chatID: newChatRef.id,\n          withUser: selectedAccount.uid,\n          chatPath: newChatRef.path\n        });\n        setDoc(selectedAccountChatRef, {\n          chatID: newChatRef.id,\n          withUser: user.uid,\n          chatPath: newChatRef.path\n        });\n        setChatSelection({\n          id: newChatRef.id,\n          name: `You and ${selectedAccount.userName || selectedAccount.name}`,\n          path: \"/privateChats/\" + newChatRef.id + \"/messages\"\n        });\n        setOpenMenu(false);\n      });\n    }\n  };\n\n  const followUser = async () => {\n    updateDoc(userAccountRef, {\n      following: arrayUnion(selectedAccount.uid)\n    });\n    updateDoc(selectedAccountRef, {\n      followers: arrayUnion(user.uid)\n    });\n  };\n\n  const unFollowUser = () => {\n    updateDoc(userAccountRef, {\n      following: arrayRemove(selectedAccount.uid)\n    });\n    updateDoc(selectedAccountRef, {\n      followers: arrayRemove(user.uid)\n    });\n  };\n\n  const accountsRef = collection(db, \"accounts\");\n  const accountsQ = query(accountsRef, orderBy(\"name\"), limitToLast(25));\n  const [accounts, accountsLoading, accountsError, snapshot] = useCollectionData(accountsQ);\n\n  if (selectedAccountLoading || userLoading) {\n    return /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 12\n    }, this);\n  } else if (selectedAccountError || userError) {\n    return /*#__PURE__*/_jsxDEV(Error, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 12\n    }, this);\n  } else {\n    const followCheck = userAccount.following.includes(selectedAccount.uid);\n    const followBackCheck = selectedAccount.following.includes(userAccount.uid);\n    const followDisplay = followCheck && followBackCheck ? \"Following eachother\" : followCheck ? \"Following\" : followBackCheck ? \"Follows you\" : \"\";\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"settings-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"\",\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"blue-heading\",\n            children: selectedAccount.userName || selectedAccount.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 159,\n            columnNumber: 13\n          }, this), selectedAccount.userName && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm font-semibold\",\n            children: selectedAccount.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 43\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm italic\",\n            children: followDisplay\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 11\n        }, this), !openFollowList && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"font-bold\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"hover:cursor-pointer\",\n              onClick: () => {\n                setOpenFollowList(true);\n                setSelectFollowList(\"following\");\n              },\n              children: [\"Followers\", \" \", selectedAccount.followers ? selectedAccount.followers.length : \"0\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 169,\n              columnNumber: 17\n            }, this), \" \", \"|\", \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"hover:cursor-pointer\",\n              onClick: () => {\n                setOpenFollowList(true);\n                setSelectFollowList(\"followers\");\n              },\n              children: [\"Following\", \" \", selectedAccount.following ? selectedAccount.following.length : \"0\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 182,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 168,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n            src: selectedAccount.photoURL || defaultPic,\n            alt: \"user\",\n            width: \"100\",\n            className: \"rounded\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 15\n          }, this), selectedAccount.uid !== user.uid && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"flex items-center gap-1 btn\",\n              onClick: followCheck ? unFollowUser : followUser,\n              children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                className: `ri-user-${followCheck ? \"unfollow\" : \"follow\"}-line`\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 209,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: followCheck ? \"Unfollow\" : \"Follow\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 214,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 205,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"flex items-center gap-1 btn\",\n              onClick: () => sendMessage(),\n              children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                className: `ri-chat-2-line`\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 220,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Message\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 221,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 216,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 204,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"Last Login:\", \" \", selectedAccount.lastLogin && selectedAccount.lastLogin.toDate().toDateString()]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 225,\n            columnNumber: 15\n          }, this), selectedAccount.uid !== user.uid && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"flex items-center gap-1 hover:cursor-pointer hover:text-blue-500\",\n            onClick: () => setScreen(\"users\"),\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"text-lg font-bold ri-arrow-go-back-line\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 236,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \" Go Back\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 237,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 232,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 9\n      }, this), openFollowList && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-col\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"flex items-center gap-1 text-sm font-bold text-blue-600 hover:cursor-pointer hover:text-blue-500\",\n            onClick: () => setOpenFollowList(false),\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"ri-arrow-go-back-line\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 253,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \" Back to profile\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 254,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"blue-heading\",\n            children: selectFollowList === \"followers\" ? \"Following\" : \"Followers\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: accounts.map((account, index) => {\n            return account[selectFollowList].includes(selectedAccount.uid) && /*#__PURE__*/_jsxDEV(\"li\", {\n              className: \"flex gap-2 p-1 border-b border-blue-200 hover:rounded hover:cursor-pointer hover:bg-blue-50/50 hover:text-blue-600\",\n              onClick: () => {\n                setAccountSelection(account.uid);\n                setOpenFollowList(false);\n                setScreen(\"profile\");\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                src: account.photoURL || defaultPic,\n                alt: \"user\",\n                width: \"25\",\n                className: \"self-center rounded\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 273,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"flex flex-col\",\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  children: [account.userName || account.name, \" \"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 280,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-sm\",\n                  children: account.userName && account.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 281,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 279,\n                columnNumber: 23\n              }, this)]\n            }, index, true, {\n              fileName: _jsxFileName,\n              lineNumber: 264,\n              columnNumber: 21\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 260,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true);\n  }\n}\n\n_s(Profile, \"/Fh+H1L8hmeV2BJnKd7wRg9M/cI=\", false, function () {\n  return [useDocumentData, useDocumentData, useDocumentData, useDocumentData, useCollectionData];\n});\n\n_c = Profile;\n\nvar _c;\n\n$RefreshReg$(_c, \"Profile\");","map":{"version":3,"sources":["C:/Users/jason/Documents/1-Web-Projects/cloud-chat/src/components/UserProfile.js"],"names":["defaultPic","doc","orderBy","limitToLast","collection","setDoc","updateDoc","arrayRemove","arrayUnion","query","where","useDocumentData","useCollectionData","useState","auth","db","Loading","Error","Profile","user","accountSelection","setAccountSelection","setScreen","setChatSelection","setOpenMenu","openFollowList","setOpenFollowList","selectFollowList","setSelectFollowList","selectedAccountRef","selectedAccount","selectedAccountLoading","selectedAccountError","userAccountRef","uid","userAccount","userLoading","userError","selectedAccountPrivateChatRef","selectedAccountPrivateChat","selectedAccountPrivateChatLoading","selectedAccountPrivateChatError","userPrivateChatRef","userPrivateChat","userPrivateChatLoading","userPrivateChatError","sendMessage","id","chatID","name","userName","path","chatPath","userChatRef","selectedAccountChatRef","newChatRef","users","then","withUser","followUser","following","followers","unFollowUser","accountsRef","accountsQ","accounts","accountsLoading","accountsError","snapshot","followCheck","includes","followBackCheck","followDisplay","length","photoURL","lastLogin","toDate","toDateString","map","account","index"],"mappings":"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","sourcesContent":["import defaultPic from \"../images/cloud-fill.png\";\r\nimport {\r\n  doc,\r\n  orderBy,\r\n  limitToLast,\r\n  collection,\r\n  setDoc,\r\n  updateDoc,\r\n  arrayRemove,\r\n  arrayUnion,\r\n  query,\r\n  where,\r\n} from \"firebase/firestore\";\r\nimport {\r\n  useDocumentData,\r\n  useCollectionData,\r\n} from \"react-firebase-hooks/firestore\";\r\nimport { useState } from \"react\";\r\nimport { auth, db } from \"../backend/firebase-config\";\r\nimport Loading from \"./Loading\";\r\nimport Error from \"./Error\";\r\n\r\nexport default function Profile({\r\n  user,\r\n  accountSelection,\r\n  setAccountSelection,\r\n  setScreen,\r\n  setChatSelection,\r\n  setOpenMenu,\r\n}) {\r\n  const [openFollowList, setOpenFollowList] = useState(false);\r\n  const [selectFollowList, setSelectFollowList] = useState(\"following\");\r\n\r\n  const selectedAccountRef = doc(db, \"accounts\", accountSelection);\r\n  const [selectedAccount, selectedAccountLoading, selectedAccountError] =\r\n    useDocumentData(selectedAccountRef);\r\n\r\n  const userAccountRef = doc(db, \"accounts\", user.uid);\r\n  const [userAccount, userLoading, userError] = useDocumentData(userAccountRef);\r\n\r\n  const selectedAccountPrivateChatRef = doc(\r\n    db,\r\n    \"accounts\",\r\n    accountSelection,\r\n    \"privateChats\",\r\n    user.uid\r\n  );\r\n  const [\r\n    selectedAccountPrivateChat,\r\n    selectedAccountPrivateChatLoading,\r\n    selectedAccountPrivateChatError,\r\n  ] = useDocumentData(selectedAccountPrivateChatRef);\r\n\r\n  const userPrivateChatRef = doc(\r\n    db,\r\n    \"accounts\",\r\n    user.uid,\r\n    \"privateChats\",\r\n    accountSelection\r\n  );\r\n  const [userPrivateChat, userPrivateChatLoading, userPrivateChatError] =\r\n    useDocumentData(userPrivateChatRef);\r\n\r\n  const sendMessage = async () => {\r\n    if (userPrivateChat || selectedAccountPrivateChat) {\r\n      setChatSelection({\r\n        id: userPrivateChat.chatID,\r\n        name: `You and ${selectedAccount.userName || selectedAccount.name}`,\r\n        path: userPrivateChat.chatPath + \"/messages\",\r\n      });\r\n      setOpenMenu(false);\r\n    } else {\r\n      const userChatRef = doc(\r\n        db,\r\n        \"accounts\",\r\n        user.uid,\r\n        \"privateChats\",\r\n        selectedAccount.uid\r\n      );\r\n      const selectedAccountChatRef = doc(\r\n        db,\r\n        \"accounts\",\r\n        selectedAccount.uid,\r\n        \"privateChats\",\r\n        user.uid\r\n      );\r\n\r\n      const newChatRef = doc(collection(db, \"privateChats\"));\r\n      await setDoc(newChatRef, {\r\n        id: newChatRef.id,\r\n        users: [user.uid, selectedAccount.uid],\r\n      }).then(() => {\r\n        setDoc(userChatRef, {\r\n          chatID: newChatRef.id,\r\n          withUser: selectedAccount.uid,\r\n          chatPath: newChatRef.path,\r\n        });\r\n        setDoc(selectedAccountChatRef, {\r\n          chatID: newChatRef.id,\r\n          withUser: user.uid,\r\n          chatPath: newChatRef.path,\r\n        });\r\n        setChatSelection({\r\n          id: newChatRef.id,\r\n          name: `You and ${selectedAccount.userName || selectedAccount.name}`,\r\n          path: \"/privateChats/\" + newChatRef.id + \"/messages\",\r\n        });\r\n        setOpenMenu(false);\r\n      });\r\n    }\r\n  };\r\n\r\n  const followUser = async () => {\r\n    updateDoc(userAccountRef, {\r\n      following: arrayUnion(selectedAccount.uid),\r\n    });\r\n\r\n    updateDoc(selectedAccountRef, {\r\n      followers: arrayUnion(user.uid),\r\n    });\r\n  };\r\n\r\n  const unFollowUser = () => {\r\n    updateDoc(userAccountRef, {\r\n      following: arrayRemove(selectedAccount.uid),\r\n    });\r\n\r\n    updateDoc(selectedAccountRef, {\r\n      followers: arrayRemove(user.uid),\r\n    });\r\n  };\r\n\r\n  const accountsRef = collection(db, \"accounts\");\r\n  const accountsQ = query(accountsRef, orderBy(\"name\"), limitToLast(25));\r\n  const [accounts, accountsLoading, accountsError, snapshot] =\r\n    useCollectionData(accountsQ);\r\n\r\n  if (selectedAccountLoading || userLoading) {\r\n    return <Loading />;\r\n  } else if (selectedAccountError || userError) {\r\n    return <Error />;\r\n  } else {\r\n    const followCheck = userAccount.following.includes(selectedAccount.uid);\r\n    const followBackCheck = selectedAccount.following.includes(userAccount.uid);\r\n\r\n    const followDisplay =\r\n      followCheck && followBackCheck\r\n        ? \"Following eachother\"\r\n        : followCheck\r\n        ? \"Following\"\r\n        : followBackCheck\r\n        ? \"Follows you\"\r\n        : \"\";\r\n\r\n    return (\r\n      <>\r\n        <section className=\"settings-section\">\r\n          <div className=\"\">\r\n            <h1 className=\"blue-heading\">{selectedAccount.userName || selectedAccount.name}</h1>\r\n            {selectedAccount.userName && (<p className=\"text-sm font-semibold\">{selectedAccount.name}</p>)}\r\n            <p className=\"text-sm italic\">{followDisplay}</p>\r\n          </div>\r\n\r\n          {/* Default screen */}\r\n\r\n          {!openFollowList && (\r\n            <>\r\n              <p className=\"font-bold\">\r\n                <span\r\n                  className=\"hover:cursor-pointer\"\r\n                  onClick={() => {\r\n                    setOpenFollowList(true);\r\n                    setSelectFollowList(\"following\");\r\n                  }}\r\n                >\r\n                  Followers{\" \"}\r\n                  {selectedAccount.followers\r\n                    ? selectedAccount.followers.length\r\n                    : \"0\"}\r\n                </span>{\" \"}\r\n                |{\" \"}\r\n                <span\r\n                  className=\"hover:cursor-pointer\"\r\n                  onClick={() => {\r\n                    setOpenFollowList(true);\r\n                    setSelectFollowList(\"followers\");\r\n                  }}\r\n                >\r\n                  Following{\" \"}\r\n                  {selectedAccount.following\r\n                    ? selectedAccount.following.length\r\n                    : \"0\"}\r\n                </span>\r\n              </p>\r\n\r\n              <img\r\n                src={selectedAccount.photoURL || defaultPic}\r\n                alt=\"user\"\r\n                width=\"100\"\r\n                className=\"rounded\"\r\n              />\r\n\r\n              {selectedAccount.uid !== user.uid && (\r\n                <div className=\"flex gap-2\">\r\n                  <button\r\n                    className=\"flex items-center gap-1 btn\"\r\n                    onClick={followCheck ? unFollowUser : followUser}\r\n                  >\r\n                    <i\r\n                      className={`ri-user-${\r\n                        followCheck ? \"unfollow\" : \"follow\"\r\n                      }-line`}\r\n                    ></i>\r\n                    <span>{followCheck ? \"Unfollow\" : \"Follow\"}</span>\r\n                  </button>\r\n                  <button\r\n                    className=\"flex items-center gap-1 btn\"\r\n                    onClick={() => sendMessage()}\r\n                  >\r\n                    <i className={`ri-chat-2-line`}></i>\r\n                    <span>Message</span>\r\n                  </button>\r\n                </div>\r\n              )}\r\n              <p>\r\n                Last Login:{\" \"}\r\n                {selectedAccount.lastLogin &&\r\n                  selectedAccount.lastLogin.toDate().toDateString()}\r\n              </p>\r\n\r\n              {selectedAccount.uid !== user.uid && (\r\n                <p\r\n                  className=\"flex items-center gap-1 hover:cursor-pointer hover:text-blue-500\"\r\n                  onClick={() => setScreen(\"users\")}\r\n                >\r\n                  <i className=\"text-lg font-bold ri-arrow-go-back-line\"></i>\r\n                  <span> Go Back</span>\r\n                </p>\r\n              )}\r\n            </>\r\n          )}\r\n        </section>\r\n\r\n        {/* Follower/Following Screen */}\r\n\r\n        {openFollowList && (\r\n          <>\r\n            <div className=\"flex flex-col\">\r\n              <button\r\n                className=\"flex items-center gap-1 text-sm font-bold text-blue-600 hover:cursor-pointer hover:text-blue-500\"\r\n                onClick={() => setOpenFollowList(false)}\r\n              >\r\n                <i className=\"ri-arrow-go-back-line\"></i>\r\n                <span> Back to profile</span>\r\n              </button>\r\n              <h1 className=\"blue-heading\">\r\n                {selectFollowList === \"followers\" ? \"Following\" : \"Followers\"}\r\n              </h1>\r\n            </div>\r\n            <ul>\r\n              {accounts.map((account, index) => {\r\n                return (\r\n                  account[selectFollowList].includes(selectedAccount.uid) && (\r\n                    <li\r\n                      className=\"flex gap-2 p-1 border-b border-blue-200 hover:rounded hover:cursor-pointer hover:bg-blue-50/50 hover:text-blue-600\"\r\n                      key={index}\r\n                      onClick={() => {\r\n                        setAccountSelection(account.uid);\r\n                        setOpenFollowList(false);\r\n                        setScreen(\"profile\");\r\n                      }}\r\n                    >\r\n                      <img\r\n                        src={account.photoURL || defaultPic}\r\n                        alt=\"user\"\r\n                        width=\"25\"\r\n                        className=\"self-center rounded\"\r\n                      />\r\n                      <span className=\"flex flex-col\">\r\n                        <p>{account.userName || account.name} </p>\r\n                        <p className=\"text-sm\">\r\n                          {account.userName && account.name}\r\n                        </p>\r\n                      </span>\r\n                    </li>\r\n                  )\r\n                );\r\n              })}\r\n            </ul>\r\n          </>\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}