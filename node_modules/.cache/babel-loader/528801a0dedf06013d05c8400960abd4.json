{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\jason\\\\Documents\\\\1-Web-Projects\\\\cloud-chat\\\\src\\\\components\\\\Main.js\",\n    _s = $RefreshSig$();\n\nimport { auth, db } from \"../backend/firebase-config\";\nimport { getStorage, storageRef } from 'firebase/storage';\nimport { useDownloadURL } from 'react-firebase-hooks/storage';\nimport { collection, setDoc, doc, query, orderBy, limitToLast, serverTimestamp, getDoc, updateDoc } from \"firebase/firestore\";\nimport { useCollectionData, useDocumentData } from \"react-firebase-hooks/firestore\";\nimport Error from \"./Error\";\nimport Loading from \"./Loading\";\nimport SignIn from \"./SignIn\";\nimport DropMenu from \"./DropMenu\";\nimport { useState, useEffect, useRef } from \"react\";\nimport Header from \"./Header\";\nimport UserDisplay from \"./UserDisplay\";\nimport MessageForm from \"./MessageForm\";\nimport ChatMessage from \"./ChatMessage\";\nimport PublicChats from \"./PublicChats\";\nimport UserSettings from \"./user-settings-page/UserSettings\";\nimport CreateChat from \"./CreateChat\";\nimport UserProfile from \"./UserProfile\";\nimport UserList from \"./UserList\";\nimport PrivateChats from \"./PrivateChats\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction Main(_ref) {\n  _s();\n\n  let {\n    user,\n    userLoading,\n    userError\n  } = _ref;\n  const accountRef = doc(db, \"accounts\", user.uid);\n  const [account, accountLoading, accountError] = useDocumentData(accountRef);\n  const [cloudImg, cloudImgError, cloudImgLoading] = useDownloadURL(ref(db, \"gs://chat-tut-d42b0.appspot.com/defaultImage/cloud-fill.png\"));\n  useEffect(() => {\n    if (accountRef) {\n      updateDoc(accountRef, {\n        lastLogin: serverTimestamp()\n      });\n    } else {\n      setDoc(accountRef, {\n        uid: user.uid,\n        name: user.displayName,\n        userName: \"\",\n        email: user.email,\n        photoURL: (user === null || user === void 0 ? void 0 : user.photoURL) || cloudImg,\n        lastLogin: serverTimestamp(),\n        followers: [],\n        following: []\n      });\n    }\n  }, []);\n  /* account ID selection from UserList */\n\n  const [accountSelection, setAccountSelection] = useState(null);\n  /* drop-down menu toggled from header */\n\n  const [openMenu, setOpenMenu] = useState(false);\n  /* room selected from chat room list */\n\n  const [chatSelection, setChatSelection] = useState({\n    id: \"96UnBx22d0OWd45HtlFt\",\n    name: \"Main\",\n    path: \"/publicChats/96UnBx22d0OWd45HtlFt/messages\"\n  });\n  /* for viewing older messages, sets limitToLast in messagesQ below*/\n\n  const [messagesLimit, setMessagesLimit] = useState(25);\n  /* resets message limit when changing chats */\n\n  useEffect(() => {\n    setMessagesLimit(25);\n  }, [chatSelection]);\n  const messagesRef = collection(db, chatSelection.path);\n  const messagesQ = query(messagesRef, orderBy(\"createdAt\"), limitToLast(messagesLimit));\n  const [messages, messagesLoading, messagesError] = useCollectionData(messagesQ, {\n    idField: \"id\"\n  });\n  /* message form */\n\n  const [formValue, setFormValue] = useState(\"\");\n\n  const sendMessage = async e => {\n    e.preventDefault();\n    const {\n      uid\n    } = auth.currentUser;\n    const newMessageRef = doc(messagesRef);\n    await setDoc(newMessageRef, {\n      text: formValue,\n      createdAt: serverTimestamp(),\n      uid,\n      messageID: newMessageRef.id\n    });\n    setFormValue(\"\");\n  };\n  /* scrolling chatroom to bottom */\n\n\n  const dummy = useRef();\n  useEffect(() => {\n    if (user && messages) {\n      dummy.current.scrollIntoView({\n        behavior: \"smooth\"\n      });\n    }\n  }, [user, messages]);\n  /* screen display in drop-down menu */\n\n  const [screen, setScreen] = useState(\"chat\");\n  /* theme */\n\n  const [darkMode, setDarkMode] = useState(false);\n\n  if (userLoading) {\n    return /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 12\n    }, this);\n  } else if (userError) {\n    return /*#__PURE__*/_jsxDEV(Error, {\n      error: userError,\n      content: \"user\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 12\n    }, this);\n  } else {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `${darkMode && \"dark\"}`,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"background\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `main-container`,\n          children: [/*#__PURE__*/_jsxDEV(Header, {\n            user: user,\n            openMenu: openMenu,\n            setOpenMenu: setOpenMenu,\n            chatSelection: chatSelection,\n            darkMode: darkMode,\n            setDarkMode: setDarkMode,\n            children: user && /*#__PURE__*/_jsxDEV(UserDisplay, {\n              user: user,\n              setOpenMenu: setOpenMenu,\n              setScreen: setScreen,\n              setAccountSelection: setAccountSelection\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 149,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 140,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(DropMenu, {\n            user: user,\n            openMenu: openMenu,\n            setOpenMenu: setOpenMenu,\n            setChatSelection: setChatSelection,\n            screen: screen,\n            setScreen: setScreen,\n            setAccountSelection: setAccountSelection,\n            accountSelection: accountSelection,\n            children: [screen === \"chat\" && /*#__PURE__*/_jsxDEV(PublicChats, {\n              chatSelection: chatSelection,\n              setChatSelection: setChatSelection,\n              setOpenMenu: setOpenMenu,\n              children: /*#__PURE__*/_jsxDEV(CreateChat, {\n                user: user,\n                setChatSelection: setChatSelection,\n                setOpenMenu: setOpenMenu\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 173,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 168,\n              columnNumber: 17\n            }, this), screen === \"private-chats\" && /*#__PURE__*/_jsxDEV(PrivateChats, {\n              user: user,\n              setChatSelection: setChatSelection,\n              setOpenMenu: setOpenMenu\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 181,\n              columnNumber: 17\n            }, this), screen === \"profile\" && /*#__PURE__*/_jsxDEV(UserProfile, {\n              user: user,\n              accountSelection: accountSelection,\n              setAccountSelection: setAccountSelection,\n              setScreen: setScreen,\n              setChatSelection: setChatSelection,\n              setOpenMenu: setOpenMenu\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 188,\n              columnNumber: 17\n            }, this), screen === \"users\" && /*#__PURE__*/_jsxDEV(UserList, {\n              user: user,\n              setAccountSelection: setAccountSelection,\n              setScreen: setScreen\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 198,\n              columnNumber: 17\n            }, this), screen === \"settings\" && /*#__PURE__*/_jsxDEV(UserSettings, {\n              user: user\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 204,\n              columnNumber: 41\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n            className: \"main-box\",\n            children: /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [messagesLoading && /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 208,\n                columnNumber: 37\n              }, this), messagesError && /*#__PURE__*/_jsxDEV(Error, {\n                error: messagesError,\n                content: \"messages. Try refreshing your browser.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 210,\n                columnNumber: 19\n              }, this), messages && /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [messages.length === messagesLimit && /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"load-more-btn\",\n                  onClick: () => setMessagesLimit(messagesLimit + 25),\n                  children: \"Load older messages\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 218,\n                  columnNumber: 23\n                }, this), messages.map((message, index) => {\n                  return /*#__PURE__*/_jsxDEV(ChatMessage, {\n                    message: message,\n                    setOpenMenu: setOpenMenu,\n                    setAccountSelection: setAccountSelection,\n                    setScreen: setScreen\n                  }, index, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 227,\n                    columnNumber: 25\n                  }, this);\n                })]\n              }, void 0, true), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"mt-16\",\n                ref: dummy\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 239,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 206,\n            columnNumber: 13\n          }, this), user && /*#__PURE__*/_jsxDEV(MessageForm, {\n            sendMessage: sendMessage,\n            formValue: formValue,\n            setFormValue: setFormValue\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 7\n    }, this);\n  }\n}\n\n_s(Main, \"zVZdWYL5q7bmJ3GChcFt++14lPY=\", false, function () {\n  return [useDocumentData, useDownloadURL, useCollectionData];\n});\n\n_c = Main;\nexport default Main;\n\nvar _c;\n\n$RefreshReg$(_c, \"Main\");","map":{"version":3,"sources":["C:/Users/jason/Documents/1-Web-Projects/cloud-chat/src/components/Main.js"],"names":["auth","db","getStorage","storageRef","useDownloadURL","collection","setDoc","doc","query","orderBy","limitToLast","serverTimestamp","getDoc","updateDoc","useCollectionData","useDocumentData","Error","Loading","SignIn","DropMenu","useState","useEffect","useRef","Header","UserDisplay","MessageForm","ChatMessage","PublicChats","UserSettings","CreateChat","UserProfile","UserList","PrivateChats","Main","user","userLoading","userError","accountRef","uid","account","accountLoading","accountError","cloudImg","cloudImgError","cloudImgLoading","ref","lastLogin","name","displayName","userName","email","photoURL","followers","following","accountSelection","setAccountSelection","openMenu","setOpenMenu","chatSelection","setChatSelection","id","path","messagesLimit","setMessagesLimit","messagesRef","messagesQ","messages","messagesLoading","messagesError","idField","formValue","setFormValue","sendMessage","e","preventDefault","currentUser","newMessageRef","text","createdAt","messageID","dummy","current","scrollIntoView","behavior","screen","setScreen","darkMode","setDarkMode","length","map","message","index"],"mappings":"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","sourcesContent":["import { auth, db } from \"../backend/firebase-config\";\r\nimport { getStorage, storageRef } from 'firebase/storage';\r\nimport { useDownloadURL } from 'react-firebase-hooks/storage';\r\nimport {\r\n  collection,\r\n  setDoc,\r\n  doc,\r\n  query,\r\n  orderBy,\r\n  limitToLast,\r\n  serverTimestamp,\r\n  getDoc,\r\n  updateDoc,\r\n} from \"firebase/firestore\";\r\nimport {\r\n  useCollectionData,\r\n  useDocumentData,\r\n} from \"react-firebase-hooks/firestore\";\r\nimport Error from \"./Error\";\r\nimport Loading from \"./Loading\";\r\nimport SignIn from \"./SignIn\";\r\nimport DropMenu from \"./DropMenu\";\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport Header from \"./Header\";\r\nimport UserDisplay from \"./UserDisplay\";\r\nimport MessageForm from \"./MessageForm\";\r\nimport ChatMessage from \"./ChatMessage\";\r\nimport PublicChats from \"./PublicChats\";\r\nimport UserSettings from \"./user-settings-page/UserSettings\";\r\nimport CreateChat from \"./CreateChat\";\r\nimport UserProfile from \"./UserProfile\";\r\nimport UserList from \"./UserList\";\r\nimport PrivateChats from \"./PrivateChats\";\r\n\r\nfunction Main({ user, userLoading, userError }) {\r\n  const accountRef = doc(db, \"accounts\", user.uid);\r\n  const [account, accountLoading, accountError] = useDocumentData(accountRef);\r\n\r\n  const [cloudImg, cloudImgError, cloudImgLoading] = useDownloadURL(ref(db, \"gs://chat-tut-d42b0.appspot.com/defaultImage/cloud-fill.png\"))\r\n\r\n  useEffect(() => {\r\n    if (accountRef) {\r\n      updateDoc(accountRef, {\r\n        lastLogin: serverTimestamp(),\r\n      });\r\n    } else {\r\n      setDoc(accountRef, {\r\n        uid: user.uid,\r\n        name: user.displayName,\r\n        userName: \"\",\r\n        email: user.email,\r\n        photoURL: user?.photoURL || cloudImg,\r\n        lastLogin: serverTimestamp(),\r\n        followers: [],\r\n        following: [],\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  /* account ID selection from UserList */\r\n  const [accountSelection, setAccountSelection] = useState(null);\r\n\r\n  /* drop-down menu toggled from header */\r\n  const [openMenu, setOpenMenu] = useState(false);\r\n\r\n  /* room selected from chat room list */\r\n  const [chatSelection, setChatSelection] = useState({\r\n    id: \"96UnBx22d0OWd45HtlFt\",\r\n    name: \"Main\",\r\n    path: \"/publicChats/96UnBx22d0OWd45HtlFt/messages\",\r\n  });\r\n\r\n  /* for viewing older messages, sets limitToLast in messagesQ below*/\r\n\r\n  const [messagesLimit, setMessagesLimit] = useState(25);\r\n\r\n  /* resets message limit when changing chats */\r\n\r\n  useEffect(() => {\r\n    setMessagesLimit(25);\r\n  }, [chatSelection]);\r\n\r\n  const messagesRef = collection(db, chatSelection.path);\r\n  const messagesQ = query(\r\n    messagesRef,\r\n    orderBy(\"createdAt\"),\r\n    limitToLast(messagesLimit)\r\n  );\r\n  const [messages, messagesLoading, messagesError] = useCollectionData(\r\n    messagesQ,\r\n    {\r\n      idField: \"id\",\r\n    }\r\n  );\r\n\r\n  /* message form */\r\n  const [formValue, setFormValue] = useState(\"\");\r\n\r\n  const sendMessage = async (e) => {\r\n    e.preventDefault();\r\n\r\n    const { uid } = auth.currentUser;\r\n    const newMessageRef = doc(messagesRef);\r\n    await setDoc(newMessageRef, {\r\n      text: formValue,\r\n      createdAt: serverTimestamp(),\r\n      uid,\r\n      messageID: newMessageRef.id,\r\n    });\r\n\r\n    setFormValue(\"\");\r\n  };\r\n\r\n  /* scrolling chatroom to bottom */\r\n  const dummy = useRef();\r\n\r\n  useEffect(() => {\r\n    if (user && messages) {\r\n      dummy.current.scrollIntoView({ behavior: \"smooth\" });\r\n    }\r\n  }, [user, messages]);\r\n\r\n  /* screen display in drop-down menu */\r\n\r\n  const [screen, setScreen] = useState(\"chat\");\r\n\r\n  /* theme */\r\n\r\n  const [darkMode, setDarkMode] = useState(false);\r\n\r\n  if (userLoading) {\r\n    return <Loading />;\r\n  } else if (userError) {\r\n    return <Error error={userError} content={\"user\"} />;\r\n  } else {\r\n    return (\r\n      <div className={`${darkMode && \"dark\"}`}>\r\n        <div className=\"background\">\r\n          <div className={`main-container`}>\r\n            <Header\r\n              user={user}\r\n              openMenu={openMenu}\r\n              setOpenMenu={setOpenMenu}\r\n              chatSelection={chatSelection}\r\n              darkMode={darkMode}\r\n              setDarkMode={setDarkMode}\r\n            >\r\n              {user && (\r\n                <UserDisplay\r\n                  user={user}\r\n                  setOpenMenu={setOpenMenu}\r\n                  setScreen={setScreen}\r\n                  setAccountSelection={setAccountSelection}\r\n                />\r\n              )}\r\n            </Header>\r\n            <DropMenu\r\n              user={user}\r\n              openMenu={openMenu}\r\n              setOpenMenu={setOpenMenu}\r\n              setChatSelection={setChatSelection}\r\n              screen={screen}\r\n              setScreen={setScreen}\r\n              setAccountSelection={setAccountSelection}\r\n              accountSelection={accountSelection}\r\n            >\r\n              {screen === \"chat\" && (\r\n                <PublicChats\r\n                  chatSelection={chatSelection}\r\n                  setChatSelection={setChatSelection}\r\n                  setOpenMenu={setOpenMenu}\r\n                >\r\n                  <CreateChat\r\n                    user={user}\r\n                    setChatSelection={setChatSelection}\r\n                    setOpenMenu={setOpenMenu}\r\n                  />\r\n                </PublicChats>\r\n              )}\r\n              {screen === \"private-chats\" && (\r\n                <PrivateChats\r\n                  user={user}\r\n                  setChatSelection={setChatSelection}\r\n                  setOpenMenu={setOpenMenu}\r\n                />\r\n              )}\r\n              {screen === \"profile\" && (\r\n                <UserProfile\r\n                  user={user}\r\n                  accountSelection={accountSelection}\r\n                  setAccountSelection={setAccountSelection}\r\n                  setScreen={setScreen}\r\n                  setChatSelection={setChatSelection}\r\n                  setOpenMenu={setOpenMenu}\r\n                />\r\n              )}\r\n              {screen === \"users\" && (\r\n                <UserList\r\n                  user={user}\r\n                  setAccountSelection={setAccountSelection}\r\n                  setScreen={setScreen}\r\n                />\r\n              )}\r\n              {screen === \"settings\" && <UserSettings user={user} />}\r\n            </DropMenu>\r\n            <main className=\"main-box\">\r\n              <>\r\n                {messagesLoading && <Loading />}\r\n                {messagesError && (\r\n                  <Error\r\n                    error={messagesError}\r\n                    content={\"messages. Try refreshing your browser.\"}\r\n                  />\r\n                )}\r\n                {messages && (\r\n                  <>\r\n                    {messages.length === messagesLimit && (\r\n                      <button\r\n                        className=\"load-more-btn\"\r\n                        onClick={() => setMessagesLimit(messagesLimit + 25)}\r\n                      >\r\n                        Load older messages\r\n                      </button>\r\n                    )}\r\n                    {messages.map((message, index) => {\r\n                      return (\r\n                        <ChatMessage\r\n                          key={index}\r\n                          message={message}\r\n                          setOpenMenu={setOpenMenu}\r\n                          setAccountSelection={setAccountSelection}\r\n                          setScreen={setScreen}\r\n                        />\r\n                      );\r\n                    })}\r\n                  </>\r\n                )}\r\n\r\n                <div className=\"mt-16\" ref={dummy}></div>\r\n              </>\r\n            </main>\r\n            {user && (\r\n              <MessageForm\r\n                sendMessage={sendMessage}\r\n                formValue={formValue}\r\n                setFormValue={setFormValue}\r\n              />\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Main;\r\n"]},"metadata":{},"sourceType":"module"}