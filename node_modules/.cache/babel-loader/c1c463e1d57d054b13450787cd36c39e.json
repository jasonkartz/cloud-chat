{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\jason\\\\Documents\\\\1-Web-Projects\\\\cloud-chat\\\\src\\\\components\\\\UserSettings.js\",\n    _s = $RefreshSig$();\n\nimport defaultPic from \"../images/cloud-fill.png\";\nimport { ref, uploadBytesResumable, getDownloadURL, deleteObject, listAll } from \"firebase/storage\";\nimport { updateProfile, updateEmail, updatePassword, deleteUser, reauthenticateWithCredential, EmailAuthProvider } from \"firebase/auth\";\nimport { doc, updateDoc, deleteDoc } from \"firebase/firestore\";\nimport { useDocumentData } from \"react-firebase-hooks/firestore\";\nimport { storage, auth, db } from \"../backend/firebase-config\";\nimport { useState } from \"react\";\nimport UpdateProfileImage from \"./user-settings-page/UpdateProfileImage\";\nimport UpdateUserName from \"./user-settings-page/UpdateUserName\";\nimport UpdateName from \"./user-settings-page/UpdateName\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function UserSettings() {\n  _s();\n\n  const {\n    uid,\n    displayName,\n    email\n  } = auth.currentUser;\n  const accountRef = doc(db, \"accounts\", uid);\n  const [account, loading, error] = useDocumentData(accountRef);\n  /* collect all sign-in poviders linked to user */\n\n  const providerIdList = [];\n\n  if (auth.currentUser !== null) {\n    auth.currentUser.providerData.forEach(profile => {\n      providerIdList.push(profile.providerId);\n    });\n  }\n  /* reusable reauthentication function */\n\n\n  const reauthenticate = password => {\n    const credential = EmailAuthProvider.credential(email, password);\n    reauthenticateWithCredential(auth.currentUser, credential);\n  };\n  /* PASSWORD */\n\n\n  const [passwordForm, setPasswordForm] = useState({\n    current: \"\",\n    new: \"\",\n    email: \"\",\n    delete: \"\"\n  });\n  const [passwordStatus, setPasswordStatus] = useState(\"\");\n\n  const passwordSubmit = async () => {\n    setPasswordStatus(\"Updating password...\");\n    await reauthenticate(passwordForm.current);\n    await updatePassword(auth.currentUser, passwordForm.new).then(() => {\n      setPasswordStatus(\"Password updated\");\n      setPasswordForm({ ...passwordForm,\n        current: \"\",\n        new: \"\"\n      });\n      setTimeout(() => setPasswordStatus(\"\"), 5000);\n    }).catch(error => {\n      setPasswordStatus(\"Error updating password. Please try again.\");\n      setPasswordForm({ ...passwordForm,\n        current: \"\",\n        new: \"\"\n      });\n      setTimeout(() => setPasswordStatus(\"\"), 5000);\n    });\n  };\n  /* EMAIL */\n\n\n  const [emailForm, setEmailForm] = useState(\"\");\n  const [emailStatus, setEmailStatus] = useState(\"\");\n\n  const emailSubmit = async () => {\n    setEmailStatus(\"Updating email...\");\n    await reauthenticate(passwordForm.email);\n    await updateEmail(auth.currentUser, emailForm).then(() => {\n      updateDoc(accountRef, {\n        email: emailForm\n      }).then(() => {\n        setEmailStatus(\"Email updated: \" + emailForm);\n        setEmailForm(\"\");\n        setPasswordForm({ ...passwordForm,\n          email: \"\"\n        });\n        setTimeout(() => setEmailStatus(\"\"), 5000);\n      });\n    }).catch(error => {\n      setEmailStatus(\"Error updating email. Please try again.\");\n      setEmailForm(\"\");\n      setPasswordForm({ ...passwordForm,\n        email: \"\"\n      });\n      setTimeout(() => setEmailStatus(\"\"), 5000);\n    });\n  };\n  /* Delete Account */\n\n\n  const [deleteForm, setDeleteForm] = useState(\"\");\n  const [deleteStatus, setDeleteStatus] = useState(\"\");\n  const [deleteView, setDeleteView] = useState(false);\n\n  const deleteConfirm = async () => {\n    setDeleteStatus(\"Authenticating...\");\n    await reauthenticate(passwordForm.delete);\n\n    if (deleteForm === \"DELETE\") {\n      setPasswordForm({ ...passwordForm,\n        delete: \"\"\n      });\n      setDeleteView(true);\n      setDeleteStatus(\"Are you sure you want to delete your account? This will be permanent and cannot be recovered.\");\n    } else {\n      setDeleteStatus(\"Please type 'DELETE' in the box above before submitting.\");\n      setDeleteForm(\"\");\n      setTimeout(() => setDeleteStatus(\"\"), 5000);\n    }\n  };\n\n  const deleteCancel = () => {\n    setDeleteView(false);\n    setDeleteForm(\"\");\n    setDeleteStatus(\"Whew... that was a close one!\");\n    setTimeout(() => setDeleteStatus(\"\"), 5000);\n  };\n\n  const deleteAccount = async () => {\n    setDeleteStatus(\"Deleting account...\");\n    const userStorage = ref(storage, \"users/\" + uid);\n\n    if (userStorage) {\n      await listAll(userStorage).then(res => {\n        res.items.forEach(itemRef => {\n          deleteObject(itemRef);\n        });\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n\n    await deleteUser(auth.currentUser).then(() => {\n      deleteDoc(accountRef);\n    }).catch(error => {\n      console.log(error.code + \" \" + error.message);\n      setDeleteStatus(\"Error deleting account. Please try again.\");\n      setDeleteForm(\"\");\n      setDeleteView(false);\n      setTimeout(() => setDeleteStatus(\"\"), 5000);\n    });\n  };\n  /* render form */\n\n\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"main-box\",\n      children: /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"flex gap-1 blue-heading\",\n        children: [\"Loading\", /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"animate-spin\",\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"ri-loader-5-line\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 168,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 7\n    }, this);\n  } else if (account) {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"main\", {\n        className: \"main-box\",\n        children: [/*#__PURE__*/_jsxDEV(UpdateProfileImage, {\n          account: account,\n          accountRef: accountRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(UpdateUserName, {\n          account: account,\n          accountRef: accountRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(UpdateName, {\n          account: account,\n          accountRef: accountRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 11\n        }, this), providerIdList.includes(\"password\") && /*#__PURE__*/_jsxDEV(\"section\", {\n          className: \"settings-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"blue-heading\",\n            children: \"Email\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"email\",\n            placeholder: email,\n            className: \"form-input\",\n            value: emailForm,\n            onChange: e => {\n              setEmailForm(e.target.value);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"password\",\n            placeholder: \"Enter your password\",\n            className: \"form-input\",\n            value: passwordForm.email,\n            onChange: e => setPasswordForm({ ...passwordForm,\n              email: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"btn\",\n            disabled: !emailForm || !passwordForm.email,\n            onClick: emailSubmit,\n            children: \"Change Email\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: emailStatus\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 13\n        }, this), providerIdList.includes(\"password\") && /*#__PURE__*/_jsxDEV(\"section\", {\n          className: \"settings-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"blue-heading\",\n            children: \"Password\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"password\",\n            placeholder: \"Enter your current password\",\n            className: \"form-input\",\n            value: passwordForm.current,\n            onChange: e => setPasswordForm({ ...passwordForm,\n              current: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 224,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"password\",\n            placeholder: \"Enter your new password\",\n            className: \"form-input\",\n            value: passwordForm.new,\n            onChange: e => setPasswordForm({ ...passwordForm,\n              new: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 233,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            disabled: !passwordForm.current || !passwordForm.new,\n            className: `btn`,\n            onClick: passwordSubmit,\n            children: \"Change Password\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 242,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: passwordStatus\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 250,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n          className: \"pb-8 settings-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"blue-heading\",\n            children: \"Delete Account\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 13\n          }, this), !deleteView && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              placeholder: \"Type DELETE in all caps\",\n              className: \"form-input\",\n              value: deleteForm,\n              onChange: e => setDeleteForm(e.target.value)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 260,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"password\",\n              placeholder: \"Enter your password\",\n              className: \"form-input\",\n              value: passwordForm.delete,\n              onChange: e => setPasswordForm({ ...passwordForm,\n                delete: e.target.value\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 267,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              className: \"btn\",\n              disabled: !deleteForm || !passwordForm.delete,\n              onClick: deleteConfirm,\n              children: \"Delete Account\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 276,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: deleteStatus\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 286,\n            columnNumber: 13\n          }, this), deleteView && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn\",\n              onClick: deleteAccount,\n              children: \"Yes\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn\",\n              onClick: deleteCancel,\n              children: \"No\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 292,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 9\n      }, this)\n    }, void 0, false);\n  } else if (error) {\n    return /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"main-box\",\n      children: `Error Loading Content :(`\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 12\n    }, this);\n  }\n}\n/*\r\ntodo:\r\n- break up settings into components with their own state\r\n- link signin providers (ie. allow google signin users to create email/pass signin method)\r\n- password reset email link (ie. \"forgot password\")\r\n- confirmation email for making changes in settings / account deletion\r\n- user generated chatrooms\r\n- private messaging\r\n- switchable dark mode\r\n- allow users to load previous messages after scrolling up\r\n- allow users to view other user profiles\r\n- timestamp messages\r\n*/\n\n_s(UserSettings, \"FtOdW4K07vz5p1cdFAnVHj2CIi0=\", false, function () {\n  return [useDocumentData];\n});\n\n_c = UserSettings;\n\nvar _c;\n\n$RefreshReg$(_c, \"UserSettings\");","map":{"version":3,"sources":["C:/Users/jason/Documents/1-Web-Projects/cloud-chat/src/components/UserSettings.js"],"names":["defaultPic","ref","uploadBytesResumable","getDownloadURL","deleteObject","listAll","updateProfile","updateEmail","updatePassword","deleteUser","reauthenticateWithCredential","EmailAuthProvider","doc","updateDoc","deleteDoc","useDocumentData","storage","auth","db","useState","UpdateProfileImage","UpdateUserName","UpdateName","UserSettings","uid","displayName","email","currentUser","accountRef","account","loading","error","providerIdList","providerData","forEach","profile","push","providerId","reauthenticate","password","credential","passwordForm","setPasswordForm","current","new","delete","passwordStatus","setPasswordStatus","passwordSubmit","then","setTimeout","catch","emailForm","setEmailForm","emailStatus","setEmailStatus","emailSubmit","deleteForm","setDeleteForm","deleteStatus","setDeleteStatus","deleteView","setDeleteView","deleteConfirm","deleteCancel","deleteAccount","userStorage","res","items","itemRef","console","log","code","message","includes","e","target","value"],"mappings":"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","sourcesContent":["import defaultPic from \"../images/cloud-fill.png\";\r\nimport {\r\n  ref,\r\n  uploadBytesResumable,\r\n  getDownloadURL,\r\n  deleteObject,\r\n  listAll,\r\n} from \"firebase/storage\";\r\nimport {\r\n  updateProfile,\r\n  updateEmail,\r\n  updatePassword,\r\n  deleteUser,\r\n  reauthenticateWithCredential,\r\n  EmailAuthProvider,\r\n} from \"firebase/auth\";\r\nimport { doc, updateDoc, deleteDoc } from \"firebase/firestore\";\r\nimport { useDocumentData } from \"react-firebase-hooks/firestore\";\r\nimport { storage, auth, db } from \"../backend/firebase-config\";\r\nimport { useState } from \"react\";\r\nimport UpdateProfileImage from \"./user-settings-page/UpdateProfileImage\";\r\nimport UpdateUserName from \"./user-settings-page/UpdateUserName\";\r\nimport UpdateName from \"./user-settings-page/UpdateName\";\r\n\r\nexport default function UserSettings() {\r\n  const { uid, displayName, email } = auth.currentUser;\r\n  const accountRef = doc(db, \"accounts\", uid);\r\n  const [account, loading, error] = useDocumentData(accountRef);\r\n\r\n  /* collect all sign-in poviders linked to user */\r\n  const providerIdList = [];\r\n\r\n  if (auth.currentUser !== null) {\r\n    auth.currentUser.providerData.forEach((profile) => {\r\n      providerIdList.push(profile.providerId);\r\n    });\r\n  }\r\n\r\n  /* reusable reauthentication function */\r\n  const reauthenticate = (password) => {\r\n    const credential = EmailAuthProvider.credential(email, password);\r\n    reauthenticateWithCredential(auth.currentUser, credential);\r\n  };\r\n\r\n  \r\n\r\n  /* PASSWORD */\r\n  const [passwordForm, setPasswordForm] = useState({\r\n    current: \"\",\r\n    new: \"\",\r\n    email: \"\",\r\n    delete: \"\",\r\n  });\r\n  const [passwordStatus, setPasswordStatus] = useState(\"\");\r\n\r\n  const passwordSubmit = async () => {\r\n    setPasswordStatus(\"Updating password...\");\r\n\r\n    await reauthenticate(passwordForm.current);\r\n\r\n    await updatePassword(auth.currentUser, passwordForm.new)\r\n      .then(() => {\r\n        setPasswordStatus(\"Password updated\");\r\n        setPasswordForm({ ...passwordForm, current: \"\", new: \"\" });\r\n        setTimeout(() => setPasswordStatus(\"\"), 5000);\r\n      })\r\n      .catch((error) => {\r\n        setPasswordStatus(\"Error updating password. Please try again.\");\r\n        setPasswordForm({ ...passwordForm, current: \"\", new: \"\" });\r\n        setTimeout(() => setPasswordStatus(\"\"), 5000);\r\n      });\r\n  };\r\n\r\n  /* EMAIL */\r\n  const [emailForm, setEmailForm] = useState(\"\");\r\n  const [emailStatus, setEmailStatus] = useState(\"\");\r\n\r\n  const emailSubmit = async () => {\r\n    setEmailStatus(\"Updating email...\");\r\n\r\n    await reauthenticate(passwordForm.email);\r\n\r\n    await updateEmail(auth.currentUser, emailForm)\r\n      .then(() => {\r\n        updateDoc(accountRef, { email: emailForm }).then(() => {\r\n          setEmailStatus(\"Email updated: \" + emailForm);\r\n          setEmailForm(\"\");\r\n          setPasswordForm({ ...passwordForm, email: \"\" });\r\n          setTimeout(() => setEmailStatus(\"\"), 5000);\r\n        });\r\n      })\r\n      .catch((error) => {\r\n        setEmailStatus(\"Error updating email. Please try again.\");\r\n        setEmailForm(\"\");\r\n        setPasswordForm({ ...passwordForm, email: \"\" });\r\n        setTimeout(() => setEmailStatus(\"\"), 5000);\r\n      });\r\n  };\r\n\r\n  /* Delete Account */\r\n\r\n  const [deleteForm, setDeleteForm] = useState(\"\");\r\n  const [deleteStatus, setDeleteStatus] = useState(\"\");\r\n  const [deleteView, setDeleteView] = useState(false);\r\n\r\n  const deleteConfirm = async () => {\r\n    setDeleteStatus(\"Authenticating...\");\r\n\r\n    await reauthenticate(passwordForm.delete);\r\n\r\n    if (deleteForm === \"DELETE\") {\r\n      setPasswordForm({ ...passwordForm, delete: \"\" });\r\n      setDeleteView(true);\r\n      setDeleteStatus(\r\n        \"Are you sure you want to delete your account? This will be permanent and cannot be recovered.\"\r\n      );\r\n    } else {\r\n      setDeleteStatus(\r\n        \"Please type 'DELETE' in the box above before submitting.\"\r\n      );\r\n      setDeleteForm(\"\");\r\n      setTimeout(() => setDeleteStatus(\"\"), 5000);\r\n    }\r\n  };\r\n\r\n  const deleteCancel = () => {\r\n    setDeleteView(false);\r\n    setDeleteForm(\"\");\r\n    setDeleteStatus(\"Whew... that was a close one!\");\r\n    setTimeout(() => setDeleteStatus(\"\"), 5000);\r\n  };\r\n\r\n  const deleteAccount = async () => {\r\n    setDeleteStatus(\"Deleting account...\");\r\n    const userStorage = ref(storage, \"users/\" + uid);\r\n    if (userStorage) {\r\n      await listAll(userStorage)\r\n        .then((res) => {\r\n          res.items.forEach((itemRef) => {\r\n            deleteObject(itemRef);\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          console.log(error);\r\n        });\r\n    }\r\n    await deleteUser(auth.currentUser)\r\n      .then(() => {\r\n        deleteDoc(accountRef);\r\n      })\r\n      .catch((error) => {\r\n        console.log(error.code + \" \" + error.message);\r\n        setDeleteStatus(\"Error deleting account. Please try again.\");\r\n        setDeleteForm(\"\");\r\n        setDeleteView(false);\r\n        setTimeout(() => setDeleteStatus(\"\"), 5000);\r\n      });\r\n  };\r\n\r\n  /* render form */\r\n\r\n  if (loading) {\r\n    return (\r\n      <main className=\"main-box\">\r\n        <h2 className=\"flex gap-1 blue-heading\">\r\n          Loading\r\n          <div className=\"animate-spin\">\r\n            <i className=\"ri-loader-5-line\"></i>\r\n          </div>\r\n        </h2>\r\n      </main>\r\n    );\r\n  } else if (account) {\r\n    return (\r\n      <>\r\n        <main className=\"main-box\">\r\n          \r\n          <UpdateProfileImage account={account} accountRef={accountRef} />\r\n\r\n          <UpdateUserName account={account} accountRef={accountRef} />\r\n\r\n          <UpdateName account={account} accountRef={accountRef} />\r\n\r\n          {/* EMAIL */}\r\n          {providerIdList.includes(\"password\") && (\r\n            <section className=\"settings-section\">\r\n              <h2 className=\"blue-heading\">Email</h2>\r\n\r\n              <input\r\n                type=\"email\"\r\n                placeholder={email}\r\n                className=\"form-input\"\r\n                value={emailForm}\r\n                onChange={(e) => {\r\n                  setEmailForm(e.target.value);\r\n                }}\r\n              />\r\n              <input\r\n                type=\"password\"\r\n                placeholder=\"Enter your password\"\r\n                className=\"form-input\"\r\n                value={passwordForm.email}\r\n                onChange={(e) =>\r\n                  setPasswordForm({ ...passwordForm, email: e.target.value })\r\n                }\r\n              />\r\n              <button\r\n                type=\"submit\"\r\n                className=\"btn\"\r\n                disabled={!emailForm || !passwordForm.email}\r\n                onClick={emailSubmit}\r\n              >\r\n                Change Email\r\n              </button>\r\n              <p>{emailStatus}</p>\r\n            </section>\r\n          )}\r\n\r\n          {/* PASSWORD */}\r\n\r\n          {providerIdList.includes(\"password\") && (\r\n            <section className=\"settings-section\">\r\n              <h2 className=\"blue-heading\">Password</h2>\r\n              <input\r\n                type=\"password\"\r\n                placeholder=\"Enter your current password\"\r\n                className=\"form-input\"\r\n                value={passwordForm.current}\r\n                onChange={(e) =>\r\n                  setPasswordForm({ ...passwordForm, current: e.target.value })\r\n                }\r\n              />\r\n              <input\r\n                type=\"password\"\r\n                placeholder=\"Enter your new password\"\r\n                className=\"form-input\"\r\n                value={passwordForm.new}\r\n                onChange={(e) =>\r\n                  setPasswordForm({ ...passwordForm, new: e.target.value })\r\n                }\r\n              />\r\n              <button\r\n                type=\"submit\"\r\n                disabled={!passwordForm.current || !passwordForm.new}\r\n                className={`btn`}\r\n                onClick={passwordSubmit}\r\n              >\r\n                Change Password\r\n              </button>\r\n              <p>{passwordStatus}</p>\r\n            </section>\r\n          )}\r\n\r\n          {/* DELETE ACCOUNT */}\r\n          <section className=\"pb-8 settings-section\">\r\n            <h2 className=\"blue-heading\">Delete Account</h2>\r\n\r\n            {!deleteView && (\r\n              <>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Type DELETE in all caps\"\r\n                  className=\"form-input\"\r\n                  value={deleteForm}\r\n                  onChange={(e) => setDeleteForm(e.target.value)}\r\n                />\r\n                <input\r\n                  type=\"password\"\r\n                  placeholder=\"Enter your password\"\r\n                  className=\"form-input\"\r\n                  value={passwordForm.delete}\r\n                  onChange={(e) =>\r\n                    setPasswordForm({ ...passwordForm, delete: e.target.value })\r\n                  }\r\n                />\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"btn\"\r\n                  disabled={!deleteForm || !passwordForm.delete}\r\n                  onClick={deleteConfirm}\r\n                >\r\n                  Delete Account\r\n                </button>\r\n              </>\r\n            )}\r\n            <p>{deleteStatus}</p>\r\n            {deleteView && (\r\n              <div className=\"flex gap-2\">\r\n                <button className=\"btn\" onClick={deleteAccount}>\r\n                  Yes\r\n                </button>\r\n                <button className=\"btn\" onClick={deleteCancel}>\r\n                  No\r\n                </button>\r\n              </div>\r\n            )}\r\n          </section>\r\n        </main>\r\n      </>\r\n    );\r\n  } else if (error) {\r\n    return <main className=\"main-box\">{`Error Loading Content :(`}</main>;\r\n  }\r\n}\r\n\r\n/*\r\ntodo:\r\n- break up settings into components with their own state\r\n- link signin providers (ie. allow google signin users to create email/pass signin method)\r\n- password reset email link (ie. \"forgot password\")\r\n- confirmation email for making changes in settings / account deletion\r\n- user generated chatrooms\r\n- private messaging\r\n- switchable dark mode\r\n- allow users to load previous messages after scrolling up\r\n- allow users to view other user profiles\r\n- timestamp messages\r\n*/\r\n"]},"metadata":{},"sourceType":"module"}