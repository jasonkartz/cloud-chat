{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\jason\\\\Documents\\\\1-Web-Projects\\\\cloud-chat\\\\src\\\\components\\\\UserSettings.js\",\n    _s = $RefreshSig$();\n\nimport defaultPic from \"../images/cloud-fill.png\";\nimport { ref, uploadBytesResumable, getDownloadURL, deleteObject, listAll } from \"firebase/storage\";\nimport { updateProfile, updateEmail, updatePassword, deleteUser, reauthenticateWithCredential } from \"firebase/auth\";\nimport { doc, updateDoc, deleteDoc } from \"firebase/firestore\";\nimport { useDocumentData } from \"react-firebase-hooks/firestore\";\nimport { storage, auth, db } from \"../backend/firebase-config\";\nimport { useState } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function UserSettings() {\n  _s();\n\n  const {\n    uid,\n    displayName,\n    email\n  } = auth.currentUser;\n  const accountRef = doc(db, \"accounts\", uid);\n  const [account, loading, error] = useDocumentData(accountRef);\n  console.log(auth.currentUser);\n  /* collect all sign-in poviders linked to user */\n\n  const providerIdList = [];\n\n  if (auth.currentUser !== null) {\n    auth.currentUser.providerData.forEach(profile => {\n      providerIdList.push(profile.providerId);\n    });\n  }\n  /* USER IMAGE */\n\n\n  const types = [\"image/jpeg\", \"image/png\"];\n  const [file, setFile] = useState(null);\n  const [uploadStatus, setUploadStatus] = useState(null);\n  const [uploadProgress, setUploadProgress] = useState(0);\n\n  const handleImage = e => {\n    let selected = e.target.files[0];\n\n    if (selected && types.includes(selected.type)) {\n      setFile(selected);\n      setUploadStatus(\"Click 'Upload Image'.\");\n    } else {\n      setFile(null);\n      setUploadStatus(\"Please select an image file (png or jpeg)\");\n    }\n  };\n\n  const imageSubmit = () => {\n    setUploadStatus(\"Updating image...\");\n    const imagePath = \"users/\" + uid + \"/user-image.\" + file.name.split(\".\").pop();\n    let fileRef = ref(storage, imagePath);\n    const uploadRef = uploadBytesResumable(fileRef, file);\n    uploadRef.on(\"state_changed\", snapshot => {\n      const progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n      setUploadProgress(progress);\n      setUploadStatus(\"uploading\");\n    }, () => error => {\n      setUploadStatus(\"upload error\");\n    }, async () => {\n      const url = await getDownloadURL(fileRef);\n      await updateProfile(auth.currentUser, {\n        photoURL: url\n      }).then(() => {\n        setUploadStatus(\"complete\");\n        updateDoc(accountRef, {\n          photoURL: url\n        });\n        setFile(null);\n        setTimeout(() => setUploadStatus(\"\"), 5000);\n      }).catch(error => {\n        setUploadStatus(\"error\");\n        setFile(null);\n      });\n    });\n  };\n  /* USER NAME */\n\n\n  const [userNameForm, setUserNameForm] = useState(\"\");\n  const [userNameStatus, setUserNameStatus] = useState(\"\");\n\n  const userNameSubmit = async () => {\n    setUserNameStatus(\"Updating Username...\");\n    await updateDoc(accountRef, {\n      userName: userNameForm\n    }).then(() => {\n      setUserNameStatus(\"Username Updated: \" + userNameForm);\n      setUserNameForm(\"\");\n      setTimeout(() => setUserNameStatus(\"\"), 5000);\n    });\n  };\n  /* NAME */\n\n\n  const [nameForm, setNameForm] = useState(\"\");\n  const [nameStatus, setNameStatus] = useState(\"\");\n\n  const nameSubmit = async () => {\n    setNameStatus(\"Updating name...\");\n    await updateProfile(auth.currentUser, {\n      displayName: nameForm\n    }).then(() => updateDoc(accountRef, {\n      name: nameForm\n    }).then(() => {\n      setNameStatus(\"Name updated: \" + nameForm);\n      setNameForm(\"\");\n      setTimeout(() => setNameStatus(\"\"), 5000);\n    }));\n  };\n  /* EMAIL */\n\n\n  const [emailForm, setEmailForm] = useState(\"\");\n  const [emailStatus, setEmailStatus] = useState(\"\");\n\n  const emailSubmit = async () => {\n    setEmailStatus(\"Updating email...\");\n    await updateEmail(auth.currentUser, emailForm).then(() => {\n      updateDoc(accountRef, {\n        email: emailForm\n      }).then(() => {\n        setEmailStatus(\"Email updated: \" + emailForm);\n        setEmailForm(\"\");\n        setTimeout(() => setEmailStatus(\"\"), 5000);\n      });\n    }).catch(error => {\n      setEmailStatus(\"Error updating email. Please try again.\");\n      setEmailForm(\"\");\n      setTimeout(() => setEmailStatus(\"\"), 5000);\n    });\n  };\n  /* PASSWORD */\n\n\n  const [passwordForm, setPasswordForm] = useState({\n    current: \"\",\n    new: \"\"\n  });\n  const [passwordStatus, setPasswordStatus] = useState(\"\");\n\n  const passwordSubmit = async () => {\n    setPasswordStatus(\"Updating password...\");\n    await updatePassword(auth.currentUser, passwordForm).then(() => {\n      setPasswordStatus(\"Password updated\");\n      setPasswordForm(\"\");\n      setTimeout(() => setPasswordStatus(\"\"), 5000);\n    }).catch(error => {\n      setPasswordStatus(\"Error updating password. Please try again.\");\n      setPasswordForm(\"\");\n      setTimeout(() => setPasswordStatus(\"\"), 5000);\n    });\n  };\n  /* Delete Account */\n\n\n  const [deleteForm, setDeleteForm] = useState(\"\");\n  const [deleteStatus, setDeleteStatus] = useState(\"\");\n  const [deleteView, setDeleteView] = useState(false);\n\n  const deleteConfirm = async () => {\n    await reauthenticateWithCredential(auth.currentUser, email, passwordForm.current).then(() => {\n      if (deleteForm === \"DELETE\") {\n        setDeleteView(true);\n        setDeleteStatus(\"Are you sure you want to delete your account? This will be permanent and cannot be recovered.\");\n      } else {\n        setDeleteStatus(\"Please type 'DELETE' in the box above before submitting.\");\n        setDeleteForm(\"\");\n        setTimeout(() => setDeleteStatus(\"\"), 5000);\n      }\n    }).catch(error => {\n      console.log(error);\n    });\n  };\n\n  const deleteCancel = () => {\n    setDeleteView(false);\n    setDeleteForm(\"\");\n    setDeleteStatus(\"Whew... that was a close one!\");\n    setTimeout(() => setDeleteStatus(\"\"), 5000);\n  };\n\n  const deleteAccount = async () => {\n    setDeleteStatus(\"Deleting account...\");\n    const userStorage = ref(storage, \"users/\" + uid);\n\n    if (userStorage) {\n      await listAll(userStorage).then(res => {\n        res.items.forEach(itemRef => {\n          deleteObject(itemRef);\n        });\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n\n    await deleteUser(auth.currentUser).then(() => {\n      deleteDoc(accountRef);\n    }).catch(error => {\n      console.log(error.code + \" \" + error.message);\n      setDeleteStatus(\"Error deleting account. Please try again.\");\n      setDeleteForm(\"\");\n      setDeleteView(false);\n      setTimeout(() => setDeleteStatus(\"\"), 5000);\n    });\n  };\n\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"main-box\",\n      children: /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"flex gap-1 blue-heading\",\n        children: [\"Loading\", /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"animate-spin\",\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"ri-loader-5-line\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 7\n    }, this);\n  } else if (account) {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"main\", {\n        className: \"main-box\",\n        children: [/*#__PURE__*/_jsxDEV(\"section\", {\n          className: \"settings-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"blue-heading\",\n            children: \"Profile Image\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n            src: account.photoURL || defaultPic,\n            alt: \"user\",\n            width: \"100\",\n            className: \"rounded\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 240,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            onChange: handleImage\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 247,\n            columnNumber: 13\n          }, this), file && /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [\"File selected: \", file.name]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 248,\n            columnNumber: 22\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: `btn`,\n            disabled: !file || uploadStatus === \"uploading\",\n            onClick: imageSubmit,\n            children: uploadStatus === \"uploading\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex gap-1\",\n              children: [\"Uploading\", /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"animate-spin\",\n                children: /*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"ri-loader-5-line\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 259,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 258,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 256,\n              columnNumber: 17\n            }, this) : \"Upload Image\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 13\n          }, this), uploadStatus === \"uploading\" ? \"Uploading... \" + uploadProgress + \"%\" : uploadStatus === \"complete\" ? \"Image updated!\" : uploadStatus === \"error\" ? \"An error occured\" : \"\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n          className: \"settings-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"blue-heading\",\n            children: \"User Name\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 278,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: account.userName || \"Create User Name\",\n            className: \"form-input\",\n            value: userNameForm,\n            onChange: e => setUserNameForm(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 280,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"btn\",\n            onClick: userNameSubmit,\n            disabled: !userNameForm,\n            children: account.userName ? \"Update User Name\" : \"Create User Name\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: userNameStatus\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n          className: \"settings-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"blue-heading\",\n            children: \"Name\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 300,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: account.name,\n            className: \"form-input\",\n            value: nameForm,\n            onChange: e => setNameForm(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 302,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"btn\",\n            disabled: !nameForm,\n            onClick: nameSubmit,\n            children: \"Change Name\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 309,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: nameStatus\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 317,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 11\n        }, this), providerIdList.includes(\"password\") && /*#__PURE__*/_jsxDEV(\"section\", {\n          className: \"settings-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"blue-heading\",\n            children: \"Email\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 323,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"email\",\n            placeholder: email,\n            className: \"form-input\",\n            value: emailForm,\n            onChange: e => {\n              setEmailForm(e.target.value);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 325,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"btn\",\n            disabled: !emailForm,\n            onClick: emailSubmit,\n            children: \"Change Email\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 334,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: emailStatus\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 342,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 13\n        }, this), providerIdList.includes(\"password\") && /*#__PURE__*/_jsxDEV(\"section\", {\n          className: \"settings-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"blue-heading\",\n            children: \"Password\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 350,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"password\",\n            placeholder: \"Enter your new password\",\n            className: \"form-input\",\n            value: passwordForm.new,\n            onChange: e => setPasswordForm({ ...passwordForm,\n              new: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 352,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            disabled: !passwordForm,\n            className: `btn`,\n            onClick: passwordSubmit,\n            children: \"Change Password\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 359,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: passwordStatus\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 367,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 349,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n          className: \"pb-8 settings-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"blue-heading\",\n            children: \"Delete Account\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 13\n          }, this), !deleteView && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              placeholder: \"Type DELETE in all caps\",\n              className: \"form-input\",\n              value: deleteForm,\n              onChange: e => setDeleteForm(e.target.value)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 377,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"password\",\n              placeholder: \"Enter your password\",\n              className: \"form-input\",\n              value: passwordForm.current,\n              onChange: e => setPasswordForm({ ...passwordForm,\n                current: e.target.value\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 384,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              className: \"btn\",\n              disabled: !deleteForm || !passwordForm.current,\n              onClick: deleteConfirm,\n              children: \"Delete Account\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 391,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: deleteStatus\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 401,\n            columnNumber: 13\n          }, this), deleteView && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn\",\n              onClick: deleteAccount,\n              children: \"Yes\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 404,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn\",\n              onClick: deleteCancel,\n              children: \"No\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 407,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 403,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 9\n      }, this)\n    }, void 0, false);\n  } else if (error) {\n    return /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"main-box\",\n      children: `Error Loading Content :(`\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 417,\n      columnNumber: 12\n    }, this);\n  }\n}\n\n_s(UserSettings, \"InBCFRQFirru2CljfWfzncHnafY=\", false, function () {\n  return [useDocumentData];\n});\n\n_c = UserSettings;\n\nvar _c;\n\n$RefreshReg$(_c, \"UserSettings\");","map":{"version":3,"sources":["C:/Users/jason/Documents/1-Web-Projects/cloud-chat/src/components/UserSettings.js"],"names":["defaultPic","ref","uploadBytesResumable","getDownloadURL","deleteObject","listAll","updateProfile","updateEmail","updatePassword","deleteUser","reauthenticateWithCredential","doc","updateDoc","deleteDoc","useDocumentData","storage","auth","db","useState","UserSettings","uid","displayName","email","currentUser","accountRef","account","loading","error","console","log","providerIdList","providerData","forEach","profile","push","providerId","types","file","setFile","uploadStatus","setUploadStatus","uploadProgress","setUploadProgress","handleImage","e","selected","target","files","includes","type","imageSubmit","imagePath","name","split","pop","fileRef","uploadRef","on","snapshot","progress","bytesTransferred","totalBytes","url","photoURL","then","setTimeout","catch","userNameForm","setUserNameForm","userNameStatus","setUserNameStatus","userNameSubmit","userName","nameForm","setNameForm","nameStatus","setNameStatus","nameSubmit","emailForm","setEmailForm","emailStatus","setEmailStatus","emailSubmit","passwordForm","setPasswordForm","current","new","passwordStatus","setPasswordStatus","passwordSubmit","deleteForm","setDeleteForm","deleteStatus","setDeleteStatus","deleteView","setDeleteView","deleteConfirm","deleteCancel","deleteAccount","userStorage","res","items","itemRef","code","message","value"],"mappings":"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","sourcesContent":["import defaultPic from \"../images/cloud-fill.png\";\r\nimport {\r\n  ref,\r\n  uploadBytesResumable,\r\n  getDownloadURL,\r\n  deleteObject,\r\n  listAll,\r\n} from \"firebase/storage\";\r\nimport {\r\n  updateProfile,\r\n  updateEmail,\r\n  updatePassword,\r\n  deleteUser,\r\n  reauthenticateWithCredential\r\n} from \"firebase/auth\";\r\nimport { doc, updateDoc, deleteDoc } from \"firebase/firestore\";\r\nimport { useDocumentData } from \"react-firebase-hooks/firestore\";\r\nimport { storage, auth, db } from \"../backend/firebase-config\";\r\nimport { useState } from \"react\";\r\n\r\nexport default function UserSettings() {\r\n  const { uid, displayName, email } = auth.currentUser;\r\n  const accountRef = doc(db, \"accounts\", uid);\r\n  const [account, loading, error] = useDocumentData(accountRef);\r\n\r\n  console.log(auth.currentUser)\r\n\r\n  /* collect all sign-in poviders linked to user */\r\n  const providerIdList = [];\r\n\r\n  if (auth.currentUser !== null) {\r\n    auth.currentUser.providerData.forEach((profile) => {\r\n      providerIdList.push(profile.providerId);\r\n    });\r\n  }\r\n\r\n  /* USER IMAGE */\r\n\r\n  const types = [\"image/jpeg\", \"image/png\"];\r\n  const [file, setFile] = useState(null);\r\n  const [uploadStatus, setUploadStatus] = useState(null);\r\n  const [uploadProgress, setUploadProgress] = useState(0);\r\n\r\n  const handleImage = (e) => {\r\n    let selected = e.target.files[0];\r\n\r\n    if (selected && types.includes(selected.type)) {\r\n      setFile(selected);\r\n      setUploadStatus(\"Click 'Upload Image'.\");\r\n    } else {\r\n      setFile(null);\r\n      setUploadStatus(\"Please select an image file (png or jpeg)\");\r\n    }\r\n  };\r\n\r\n  const imageSubmit = () => {\r\n    setUploadStatus(\"Updating image...\");\r\n    const imagePath =\r\n      \"users/\" + uid + \"/user-image.\" + file.name.split(\".\").pop();\r\n    let fileRef = ref(storage, imagePath);\r\n    const uploadRef = uploadBytesResumable(fileRef, file);\r\n\r\n    uploadRef.on(\r\n      \"state_changed\",\r\n      (snapshot) => {\r\n        const progress =\r\n          (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\r\n        setUploadProgress(progress);\r\n        setUploadStatus(\"uploading\");\r\n      },\r\n      () => (error) => {\r\n        setUploadStatus(\"upload error\");\r\n      },\r\n      async () => {\r\n        const url = await getDownloadURL(fileRef);\r\n\r\n        await updateProfile(auth.currentUser, { photoURL: url })\r\n          .then(() => {\r\n            setUploadStatus(\"complete\");\r\n            updateDoc(accountRef, { photoURL: url });\r\n            setFile(null);\r\n            setTimeout(() => setUploadStatus(\"\"), 5000);\r\n          })\r\n          .catch((error) => {\r\n            setUploadStatus(\"error\");\r\n            setFile(null);\r\n          });\r\n      }\r\n    );\r\n  };\r\n\r\n  /* USER NAME */\r\n\r\n  const [userNameForm, setUserNameForm] = useState(\"\");\r\n  const [userNameStatus, setUserNameStatus] = useState(\"\");\r\n\r\n  const userNameSubmit = async () => {\r\n    setUserNameStatus(\"Updating Username...\");\r\n    await updateDoc(accountRef, { userName: userNameForm }).then(() => {\r\n      setUserNameStatus(\"Username Updated: \" + userNameForm);\r\n      setUserNameForm(\"\");\r\n      setTimeout(() => setUserNameStatus(\"\"), 5000);\r\n    });\r\n  };\r\n\r\n  /* NAME */\r\n\r\n  const [nameForm, setNameForm] = useState(\"\");\r\n  const [nameStatus, setNameStatus] = useState(\"\");\r\n\r\n  const nameSubmit = async () => {\r\n    setNameStatus(\"Updating name...\");\r\n    await updateProfile(auth.currentUser, { displayName: nameForm }).then(() =>\r\n      updateDoc(accountRef, { name: nameForm }).then(() => {\r\n        setNameStatus(\"Name updated: \" + nameForm);\r\n        setNameForm(\"\");\r\n        setTimeout(() => setNameStatus(\"\"), 5000);\r\n      })\r\n    );\r\n  };\r\n\r\n  /* EMAIL */\r\n  const [emailForm, setEmailForm] = useState(\"\");\r\n  const [emailStatus, setEmailStatus] = useState(\"\");\r\n\r\n  const emailSubmit = async () => {\r\n    setEmailStatus(\"Updating email...\");\r\n    await updateEmail(auth.currentUser, emailForm)\r\n      .then(() => {\r\n        updateDoc(accountRef, { email: emailForm }).then(() => {\r\n          setEmailStatus(\"Email updated: \" + emailForm);\r\n          setEmailForm(\"\");\r\n          setTimeout(() => setEmailStatus(\"\"), 5000);\r\n        });\r\n      })\r\n      .catch((error) => {\r\n        setEmailStatus(\"Error updating email. Please try again.\");\r\n        setEmailForm(\"\");\r\n        setTimeout(() => setEmailStatus(\"\"), 5000);\r\n      });\r\n  };\r\n\r\n  /* PASSWORD */\r\n  const [passwordForm, setPasswordForm] = useState({current: \"\", new: \"\"});\r\n  const [passwordStatus, setPasswordStatus] = useState(\"\");\r\n\r\n  const passwordSubmit = async () => {\r\n    setPasswordStatus(\"Updating password...\");\r\n    await updatePassword(auth.currentUser, passwordForm)\r\n      .then(() => {\r\n        setPasswordStatus(\"Password updated\");\r\n        setPasswordForm(\"\");\r\n        setTimeout(() => setPasswordStatus(\"\"), 5000);\r\n      })\r\n      .catch((error) => {\r\n        setPasswordStatus(\"Error updating password. Please try again.\");\r\n        setPasswordForm(\"\");\r\n        setTimeout(() => setPasswordStatus(\"\"), 5000);\r\n      });\r\n  };\r\n\r\n  /* Delete Account */\r\n\r\n  const [deleteForm, setDeleteForm] = useState(\"\");\r\n  const [deleteStatus, setDeleteStatus] = useState(\"\");\r\n  const [deleteView, setDeleteView] = useState(false);\r\n\r\n  const deleteConfirm = async () => {\r\n    await reauthenticateWithCredential(auth.currentUser, email, passwordForm.current).then(() => {\r\n      if (deleteForm === \"DELETE\") {\r\n        setDeleteView(true);\r\n        setDeleteStatus(\r\n          \"Are you sure you want to delete your account? This will be permanent and cannot be recovered.\"\r\n        );\r\n      } else {\r\n        setDeleteStatus(\r\n          \"Please type 'DELETE' in the box above before submitting.\"\r\n        );\r\n        setDeleteForm(\"\");\r\n        setTimeout(() => setDeleteStatus(\"\"), 5000);\r\n      }\r\n    }).catch(error => {\r\n      console.log(error)\r\n    })\r\n    \r\n  };\r\n\r\n  const deleteCancel = () => {\r\n    setDeleteView(false);\r\n    setDeleteForm(\"\");\r\n    setDeleteStatus(\"Whew... that was a close one!\");\r\n    setTimeout(() => setDeleteStatus(\"\"), 5000);\r\n  };\r\n\r\n  const deleteAccount = async () => {\r\n    setDeleteStatus(\"Deleting account...\");\r\n    const userStorage = ref(storage, \"users/\" + uid);\r\n    if (userStorage) {\r\n      await listAll(userStorage)\r\n        .then((res) => {\r\n          res.items.forEach((itemRef) => {\r\n            deleteObject(itemRef);\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          console.log(error);\r\n        });\r\n    }\r\n    await deleteUser(auth.currentUser)\r\n      .then(() => {\r\n        deleteDoc(accountRef);\r\n      })\r\n      .catch((error) => {\r\n        console.log(error.code + \" \" + error.message);\r\n        setDeleteStatus(\"Error deleting account. Please try again.\");\r\n        setDeleteForm(\"\");\r\n        setDeleteView(false);\r\n        setTimeout(() => setDeleteStatus(\"\"), 5000);\r\n      });\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <main className=\"main-box\">\r\n        <h2 className=\"flex gap-1 blue-heading\">\r\n          Loading\r\n          <div className=\"animate-spin\">\r\n            <i className=\"ri-loader-5-line\"></i>\r\n          </div>\r\n        </h2>\r\n      </main>\r\n    );\r\n  } else if (account) {\r\n    return (\r\n      <>\r\n        <main className=\"main-box\">\r\n          {/* USER IMAGE */}\r\n          <section className=\"settings-section\">\r\n            <h2 className=\"blue-heading\">Profile Image</h2>\r\n            <img\r\n              src={account.photoURL || defaultPic}\r\n              alt=\"user\"\r\n              width=\"100\"\r\n              className=\"rounded\"\r\n            />\r\n\r\n            <input type=\"file\" onChange={handleImage} />\r\n            {file && <div>File selected: {file.name}</div>}\r\n            <button\r\n              type=\"submit\"\r\n              className={`btn`}\r\n              disabled={!file || uploadStatus === \"uploading\"}\r\n              onClick={imageSubmit}\r\n            >\r\n              {uploadStatus === \"uploading\" ? (\r\n                <div className=\"flex gap-1\">\r\n                  Uploading\r\n                  <div className=\"animate-spin\">\r\n                    <i className=\"ri-loader-5-line\"></i>\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                \"Upload Image\"\r\n              )}\r\n            </button>\r\n\r\n            {uploadStatus === \"uploading\"\r\n              ? \"Uploading... \" + uploadProgress + \"%\"\r\n              : uploadStatus === \"complete\"\r\n              ? \"Image updated!\"\r\n              : uploadStatus === \"error\"\r\n              ? \"An error occured\"\r\n              : \"\"}\r\n          </section>\r\n\r\n          {/* USER NAME */}\r\n          <section className=\"settings-section\">\r\n            <h2 className=\"blue-heading\">User Name</h2>\r\n\r\n            <input\r\n              type=\"text\"\r\n              placeholder={account.userName || \"Create User Name\"}\r\n              className=\"form-input\"\r\n              value={userNameForm}\r\n              onChange={(e) => setUserNameForm(e.target.value)}\r\n            />\r\n            <button\r\n              type=\"submit\"\r\n              className=\"btn\"\r\n              onClick={userNameSubmit}\r\n              disabled={!userNameForm}\r\n            >\r\n              {account.userName ? \"Update User Name\" : \"Create User Name\"}\r\n            </button>\r\n            <p>{userNameStatus}</p>\r\n          </section>\r\n\r\n          {/* NAME */}\r\n          <section className=\"settings-section\">\r\n            <h2 className=\"blue-heading\">Name</h2>\r\n\r\n            <input\r\n              type=\"text\"\r\n              placeholder={account.name}\r\n              className=\"form-input\"\r\n              value={nameForm}\r\n              onChange={(e) => setNameForm(e.target.value)}\r\n            />\r\n            <button\r\n              type=\"submit\"\r\n              className=\"btn\"\r\n              disabled={!nameForm}\r\n              onClick={nameSubmit}\r\n            >\r\n              Change Name\r\n            </button>\r\n            <p>{nameStatus}</p>\r\n          </section>\r\n\r\n          {/* EMAIL */}\r\n          {providerIdList.includes(\"password\") && (\r\n            <section className=\"settings-section\">\r\n              <h2 className=\"blue-heading\">Email</h2>\r\n\r\n              <input\r\n                type=\"email\"\r\n                placeholder={email}\r\n                className=\"form-input\"\r\n                value={emailForm}\r\n                onChange={(e) => {\r\n                  setEmailForm(e.target.value);\r\n                }}\r\n              />\r\n              <button\r\n                type=\"submit\"\r\n                className=\"btn\"\r\n                disabled={!emailForm}\r\n                onClick={emailSubmit}\r\n              >\r\n                Change Email\r\n              </button>\r\n              <p>{emailStatus}</p>\r\n            </section>\r\n          )}\r\n\r\n          {/* PASSWORD */}\r\n\r\n          {providerIdList.includes(\"password\") && (\r\n            <section className=\"settings-section\">\r\n              <h2 className=\"blue-heading\">Password</h2>\r\n\r\n              <input\r\n                type=\"password\"\r\n                placeholder=\"Enter your new password\"\r\n                className=\"form-input\"\r\n                value={passwordForm.new}\r\n                onChange={(e) => setPasswordForm({...passwordForm, new: e.target.value})}\r\n              />\r\n              <button\r\n                type=\"submit\"\r\n                disabled={!passwordForm}\r\n                className={`btn`}\r\n                onClick={passwordSubmit}\r\n              >\r\n                Change Password\r\n              </button>\r\n              <p>{passwordStatus}</p>\r\n            </section>\r\n          )}\r\n\r\n          {/* DELETE ACCOUNT */}\r\n          <section className=\"pb-8 settings-section\">\r\n            <h2 className=\"blue-heading\">Delete Account</h2>\r\n\r\n            {!deleteView && (\r\n              <>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Type DELETE in all caps\"\r\n                  className=\"form-input\"\r\n                  value={deleteForm}\r\n                  onChange={(e) => setDeleteForm(e.target.value)}\r\n                />\r\n                <input\r\n                type=\"password\"\r\n                placeholder=\"Enter your password\"\r\n                className=\"form-input\"\r\n                value={passwordForm.current}\r\n                onChange={(e) => setPasswordForm({...passwordForm, current: e.target.value})}\r\n              />\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"btn\"\r\n                  disabled={!deleteForm || !passwordForm.current}\r\n                  onClick={deleteConfirm}\r\n                >\r\n                  Delete Account\r\n                </button>\r\n              </>\r\n            )}\r\n            <p>{deleteStatus}</p>\r\n            {deleteView && (\r\n              <div className=\"flex gap-2\">\r\n                <button className=\"btn\" onClick={deleteAccount}>\r\n                  Yes\r\n                </button>\r\n                <button className=\"btn\" onClick={deleteCancel}>\r\n                  No\r\n                </button>\r\n              </div>\r\n            )}\r\n          </section>\r\n        </main>\r\n      </>\r\n    );\r\n  } else if (error) {\r\n    return <main className=\"main-box\">{`Error Loading Content :(`}</main>;\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}